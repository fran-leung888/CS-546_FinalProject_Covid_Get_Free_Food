<link rel="stylesheet" type="text/css" href="/public/css/style2.0.css">




<div class="header-wrap">
    <div class="navwrap">
        <div id="nav">
            <div class="navbar clearfix">
                <!-- <a class="navbt" href="#"><span>团购地图</span></a> -->





                <!-- <input type="button" name="" id="" class="navbt"> -->
                <!-- <a class="current" href="#">首页</a>
                <a href="#">餐饮美食</a>
                <a href="#">休闲娱乐</a>
                <a href="#">旅游住宿</a> -->
                <!-- <a href="#">in stock</a> -->
                <a2 href="#">in stock</a2>

                <label class="navbt" ><input class="mui-switch mui-switch-animbg"
                                                                  type="checkbox"></label>
                <div class="navbt"  style="left: 80%">
                        <input type="text"  class="search" placeholder="搜索">
                </div>

                <div class="navbt" style="left: 100%">
<!--                    <button type="button"  class="btn">search</button>-->

                    <input type="button"  id="foodSearchButton" value="搜索"  name="" id="" class="btn">
                </div>




            </div>


            <div class="pros subpage">
                <h2 ><span id="foodCategory1">{{searchParams.foodCategory1}}</span><span id="foodCategoryHelper">{{searchParams.foodCategoryHelper}}</span><span id="foodCategory2">{{searchParams.foodCategory2}}</span></h2>
                <ul class="prosul clearfix" id="proinfo">
                    <li class="food">
                        <i>&gt;</i>
                        <a class="ti" >Fast Food</a>
                        <div class="prosmore hide">
                            <span><em><a >Burgers</a></em></span>
                            <span><em><a >Pizza</a></em></span>
                            <span><em><a >Sandwiches</a></em></span>
                        </div>
                    </li>
                    <li class="food">
                        <i>&gt;</i>
                        <a class="ti" >Asian</a>
                        <div class="prosmore hide">
                            <span><em><a >Sushi</a></em></span>
                            <span><em><a >Noodle</a></em></span>
                            <span><em><a >Dumplings</a></em></span>
                        </div>
                    </li>
                    <li class="food">
                        <i>&gt;</i>
                        <a class="ti" >Fried Food</a>
                        <div class="prosmore hide">
                            <span><em><a >Fried Chicken</a></em></span>
                            <span><em><a >Fries</a></em></span>
                            <span><em><a >Fried fish</a></em></span>
                        </div>
                    </li>
                    <li class="food">
                        <i>&gt;</i>
                        <a class="ti" >Drink</a>
                        <div class="prosmore hide">
                            <span><em><a >Soup</a></em></span>
                            <span><em><a >Juice</a></em></span>
                            <span><em><a >Liquor</a></em></span>
                        </div>
                    </li>

                    <li class="food" id="tiAll">
                        <i>&gt;</i>
                        <a class="ti" >ALL</a>
<!--                        <div class="prosmore hide">-->
<!--                            <span><em><a >ALL</a></em></span>-->
<!--                        </div>-->

                    </li>

                </ul>
            </div>


            <div class="pros2 subpage2">
                <h2 id="currentOrder">排序方式</h2>
                <ul class="prosul clearfix" id="proinfo2">
                    <li class="">
                        <a class="ti" href="#">喜爱从高到低</a>
                    </li>
                    <li class="">
                        <a class="ti" href="#">喜爱从低到高</a>
                    </li>
                    <li class="">
                        <a class="ti" href="#">热量从高到低</a>
                    </li>
                    <li class="">
                        <a class="ti" href="#">热量从低到高</a>
                    </li>
                </ul>
            </div>


        </div>
    </div>
</div>




<hr class="bootstrap-iso featurette-divider">


<div class="bootstrap-iso">
    <div>
        {{#if itemsArray}}
            <div class="album py-5 bg-light">
                <div class="container">
                    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                        {{#each itemsArray}}

                                {{> item_item parameter=this}}


                        {{/each}}
                    </div>
                </div>
            </div>
        {{/if}}
    </div>
</div>


<script type="text/javascript">

    //todo 自动执行 如果url里有关键词 重新写回搜索框
    // todo 废弃了 用后端回写了
    window.onload = function () {
       /* alert(1)

        var searchParams = new URLSearchParams(window.location.search)
        var obj ={}

        for(var [key, value] of searchParams.entries()) {
            obj[key] = value
        }
        console.log("我读到了url 我要开始回写搜索框了",obj)

        //todo 判断是否有
        if (obj.foodCategory1) {
            $("#foodCategory1").html(obj.foodCategory1)
            $("#foodCategoryHelper").html(  "->")

        }

        if (obj.foodCategory2) {
            $("#foodCategory2").html(obj.foodCategory2)
            $("#foodCategoryHelper").html(  "->")


        }*/



    }

    function generateUrlWithParams(url, params) {
        var urlParams = [];
        let flag=false;
        for (var key in params) {
            if (params[key]) {
                flag=true;
                urlParams.push(`${key}=${params[key]}`)
            }
        }
        if (flag) {
            url += '?' + urlParams.join('&');
        }
        return url
    };

    $('#foodSearchButton').click(function () {

        console.log(1);
        let key = $("#foodSearchInput").val()
        let foodCategory1 = $("#foodCategory1").html()
        let foodCategory2 = $("#foodCategory2").html()
        console.log(foodCategory1);

        console.log(foodCategory2);

        let url = window.location.origin+ window.location.pathname;
        //let parentUrl = window.location.href.split("/").slice(0, -1).join("/");

        //window.location.href = window.location.host + "/foodList/?key=" + key

        url=generateUrlWithParams(url,{foodCategory1:foodCategory1,foodCategory2:foodCategory2})
        url=encodeURI(url)

        console.log(url);
        window.location.href = url


    });


    (function () {

        var $subblock = $(".subpage"),
                $head = $subblock.find('h2'),
                $ul = $("#proinfo"),
                $lis = $ul.find("li"),
                inter = false;

        $head.click(function (e) {
            e.stopPropagation();
            if (!inter) {
                $ul.show();
            } else {
                console.log(146);
                $ul.hide();
            }
            inter = !inter;
        });

        var $subblock2 = $(".subpage2"),
                $head2 = $subblock2.find('h2'),
                $ul2 = $("#proinfo2"),
                $lis2 = $ul2.find("li"),
                inter2 = false;

        $head2.click(function (e) {
            e.stopPropagation();
            if (!inter2) {
                $ul2.show();
            } else {
                $ul2.hide();
            }
            inter2 = !inter2;
        });

        $ul.click(function (event) {
            event.stopPropagation();
        });

        $(document).click(function () {
            $ul.hide();
            inter = false;
            $ul2.hide();
            inter2 = false;

            console.log("边缘被触发了 两个下拉都false")
        });

        $("em").click(function () {
            console.log("选择了新的分类");
            let $this = $(this)
            $ul.hide();
            inter = !inter;
            $("#foodCategory1").html($this.parent().parent().prev()[0].innerText)
            $("#foodCategoryHelper").html(  "->")

            $("#foodCategory2").html($this[0].innerText)
        });

        $("#tiAll").click(function () {
            console.log("tiALL");
            let $this = $(this)
            $ul.hide();
            inter = !inter;
            $("#foodCategory1").html("")
            $("#foodCategoryHelper").html("ALL")

            $("#foodCategory2").html("")
        });



        $("#proinfo2 > li").click(function () {
            //console.log("点击ul 隐藏ul");
            //console.log($(this)[0].innerText);
            console.log();
            let $this = $(this)
            console.log($this[0].innerText);
            $ul2.hide();
            inter2 = !inter2;
            $("#currentOrder").html($this[0].innerText)
        });




        $lis.hover(function () {
            if (!$(this).hasClass('nochild')) {
                $(this).addClass("prosahover");
                $(this).find(".prosmore").removeClass('hide');
            }
        }, function () {
            if (!$(this).hasClass('nochild')) {
                if ($(this).hasClass("prosahover")) {
                    $(this).removeClass("prosahover");
                }
                $(this).find(".prosmore").addClass('hide');
            }
        });

    })();


</script>